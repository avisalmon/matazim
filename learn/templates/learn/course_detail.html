{% extends 'main/base.html' %}

{% block content %}
{% if user.is_authenticated %}

      <!--                        -->
      <!-- Congratulation message -->
      <!--                        -->

<div class="text-center bg-warning {% if not registration.need_to_message_about_completion %}d-none{% endif %}">
  <h1>Congratulations! </h1>
  <br>
  <a href="#" class="btn btn-success">Rate and be certified</a>
<p><em>TBD - implement rating here. only after the user will rate this message will go away. </em></p>
</div>
{% endif %}
<div class="{% if course.hebrew %}hebrew text-right{% endif %}">

  <!--                        -->
  <!-- Lesson List section -->
  <!--                        -->

<div class="row px-4">
  <div class="col-3">
        {% if registration %}
        <!-- Show the user completion set -->
          {% if course.hebrew %}
          <h2 class="text-center">אתם רשומים לקורס זה</h2>
          <small>אתה רשום לקורס הזה. הנה רשימה השיעורים שעליך להשלים. אם המנעול פתוח, כבר השלמת את השיעור והוא נגיש לך לריענון. אם המנעול נעול, השלם את השיעורים לפי הסדר כדי לקבל גישה.</small>
          {% else %}
          <h2 class='text-center'>You are registered to this course</h2>
          <small>This are the lessone you need to complete. open lock means that you can do the lesson. closed one means there are pre-lessons you need to complete. enjoy.</small>
          {% endif %}
          <hr>
          <h2>השיעורים:</h2>
          {% if registration.last_completion %}
            <a href={% url 'learn:completion_detail' registration.last_completion.id %}>
                השיעור האחרון שביקרתם בו: {{ registration.last_completion.lesson.title }}
            </a>
            <br><br>
          {% endif %}
          <ul>
            {% for completion in user_course_completion_set %}
            <li>
              {% if completion.pre_completion.completed or not completion.pre_completion %}
              <i class="fas fa-lock-open"></i>
              {% else %}
              <i class="fas fa-lock text-info"></i>
              {% endif %}

              {% if completion.pre_completion.completed or not completion.pre_completion %}
                <a class="" href={% url 'learn:completion_detail' completion.id %}>{{ completion.lesson.title }}</a>
              {% else %}
                {{ completion.lesson.title }}
              {% endif %}

              {% if completion.completed %}
                <i class="far fa-check-circle fa-2x"></i>
              {% endif %}

            </li>
            {% endfor %}
            <a  href={% url 'learn:course_unsign' course.id %} class="btn btn-danger rounded mt-5">הסר את הקורס מהרשימה שלי<i class="fas fa-exclamation-triangle"></i></a>
          </ul>
        {% else %}
          {% if user.is_authenticated %}
            <a href={% url 'learn:course_sign' course.id %} class="btn btn-info">הוסף את הקורס לרשימה שלי</a>
            <ul class="text-muted">
              {% for lesson in course.lessons.all %}
              <li>
                {{ lesson.title }}
              </li>
              {% endfor %}
            </ul>
          {% else %}
            <p>כאן תוכל להרשם לקורס זה ולצפות בכל השיעורים. אבל צריך להרשם לאתר בשביל זה</p>
            <a href={% url 'login' %} class="btn btn-info">התחבר</a>
          {% endif %}

        {% endif %}

  </div>

  <!--                        -->
  <!-- Main content session -->
  <!--                        -->

  <div class="col border border-info px-5 pb-3">
    <div class="{% if course.hebrew %}hebrew text-right{% endif %}">
      <h1>{{ course.title}} - דף פתיחה</h1>
      {% if registration.last_completion %}
        {% if course.hebrew %}
        <h3><a href={% url 'learn:completion_detail' registration.last_completion.id %}> לשיעור האחרון שהיית בו</a></h3>
        {% else %}
        <h3><a href={% url 'learn:completion_detail' registration.last_completion.id %}>Last lesson visited</a></h3>
        {% endif %}
      {% endif %}
      <p>{{ course.description }}</p>
    </div>

    <div class="row justify-content-start">
      <div class="col-10">
        {% if course.youtube %}
        <div class="embed-responsive embed-responsive-16by9">
          <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/{{ course.youtube }}?rel=0" allowfullscreen></iframe>
        </div>
        {% else %}
        <h3>No Youtube.... </h3>
        {% endif %}
      </div>
    </div>
  </div>

  <!--                        -->
  <!-- All courses section and info -->
  <!--                        -->

  <div class="col-2">

    {% if course.hebrew %}
      <a class="btn btn-info" href={% url 'learn:course_list' %}>לרשימת כל הקורסים</a>
        {% include "learn/course_status_heb.html" %}
    {% else %}
        {% include "learn/course_status_en.html" %}
    {% endif %}
  </div>
</div>


</div>
{% endblock %}
