{% extends 'main/base.html' %}

{% block content %}
{% if user.is_authenticated %}

      <!--                        -->
      <!-- Congratulation message -->
      <!--                        -->

<div class="text-center bg-warning {% if not registration.need_to_message_about_completion %}d-none{% endif %}">
  <h1>ברכות! סיימתם קורס זה. נשאר רק לדרג</h1>
  <br>
  <a href="#" class="btn btn-success">דרג קורס זה - רק ללחוץ על הכוכב הנכון</a>
{% endif %}
</div>
{% if registration %}
<div class="container text-center">
  <p class="hebrew">הדרוג שלך לקורס זה:</p>
  <a href={% url 'learn:course_rate' registration.course.pk 1 %}>
  1{% if registration.stars > 0 %}<i class="fas fa-star"></i>{% else %} <i class="far fa-star"></i> {% endif %}
  </a>
  <a href={% url 'learn:course_rate' registration.course.pk 2 %}>
  {% if registration.stars > 1 %}<i class="fas fa-star"></i>{% else %} <i class="far fa-star"></i> {% endif %}
  </a>
  <a href={% url 'learn:course_rate' registration.course.pk 3 %}>
  {% if registration.stars > 2 %}<i class="fas fa-star"></i>{% else %} <i class="far fa-star"></i> {% endif %}
  </a>
  <a href={% url 'learn:course_rate' registration.course.pk 4 %}>
  {% if registration.stars > 3 %}<i class="fas fa-star"></i>{% else %} <i class="far fa-star"></i> {% endif %}
  </a>
  <a href={% url 'learn:course_rate' registration.course.pk 5 %}>
  {% if registration.stars > 4 %}<i class="fas fa-star"></i>{% else %} <i class="far fa-star"></i> {% endif %}5
  </a>

</div>
{% endif %}
<br>
<div class="{% if course.hebrew %}hebrew text-right{% endif %}">

  <!--                        -->
  <!-- Lesson List section -->
  <!--                        -->

<div class="row px-4">
  <div class="col-3">
        {% if registration %}
        <!-- Show the user completion set -->
          {% if course.hebrew %}
          <h2 class="text-center">אתם רשומים לקורס זה</h2>
          <small>הנה רשימת השיעורים שעליכם להשלים. אם המנעול פתוח, השיעור נגיש לכם ללמידה או לרענון. אם המנעול נעול, השלימו את השיעורים לפי הסדר כדי לקבל גישה.</small>
          {% else %}
          <h2 class='text-center'>You are registered to this course</h2>
          <small>This are the lessone you need to complete. open lock means that you can do the lesson. closed one means there are pre-lessons you need to complete. enjoy.</small>
          {% endif %}
          <hr>
          <h3>רשימת השיעורים</h3>

          <div class="container">
                <!-- Go over lesson status and links  -->

                {% for other_completion in user_course_completion_set %}
                  <!-- Lock  -->
                  <div class="row lesson-item">
                    <div class="col-1">
                      {% if other_completion.pre_completion.completed or not other_completion.pre_completion %}
                      <i class="fas fa-lock-open"></i>
                      {% else %}
                      <i class="fas fa-lock text-info"></i>
                      {% endif %}
                    </div>
                    <!-- Check simbol -->
                    <div class="col-1">
                      {% if other_completion.completed %}
                        <i class="far fa-check-circle"></i>
                      {% endif %}
                    </div>
                    <!-- Title -->
                    <div class="col-8 text-truncate">
                      {% if other_completion.pre_completion.completed or not other_completion.pre_completion %}
                        <a class="text-white" href={% url 'learn:completion_detail' other_completion.id %}>{{ other_completion.lesson.title }}</a>
                      {% else %}
                        <span class="text-muted">{{ other_completion.lesson.title }}</span>
                      {% endif %}
                    </div>
                    <!-- bookmark -->
                    <div class="col-1">
                      {% if other_completion == registration.last_completion %}
                      <i class="far fa-bookmark"></i>
                      {% endif %}
                    </div>

                  </div>
                {% endfor %}
          </div>


        {% else %}
          {% if user.is_authenticated %}
            <!-- <a href={% url 'learn:course_sign' course.id %} class="btn btn-info">הוסף את הקורס לרשימה שלי</a> -->
            <p>אלו השיעורים בקורס זה.  </p>
            <ul class="text-muted">
              {% for lesson in course.lessons.all %}
              <li>
                {{ lesson.title }}
              </li>
              {% endfor %}
            </ul>
          {% else %}
            <p>יש להתחבר לאתר כדי לצפות בשיעורים. השיעורים לקורס זה:</p>

            <ul class="text-muted">
              {% for lesson in course.lessons.all %}
              <li>
                {{ lesson.title }}
              </li>
              {% endfor %}
            </ul>

          {% endif %}

        {% endif %}

  </div>

  <!--                        -->
  <!-- Main content session -->
  <!--                        -->

  <div class="col border border-info px-5 pb-3">
    <div class="{% if course.hebrew %}hebrew text-right{% endif %}">
      <h1>
        {% if course.owner == user %}
          <a href={% url 'learn:course_update' course.pk %}><i class="fas fa-edit"></i></a>
        {% endif %}
        {{ course.title}} - דף פתיחה
      </h1>
      {% if user.is_authenticated %}
      <div class=" row {% if not registration %}d-none{% endif %}">
        <!-- deleted this expiremntaly. delete later -->
        <div class="col-2"></div>
        <div class="col-4 border border-info py-2 text-center">
          <p>רשימת השיעורים מימין</p>
        </div>
        <div class="col-4 border border-info py-2 text-center">
          {% if registration.last_completion %}
            <a href={% url 'learn:completion_detail' registration.last_completion.id %}> לשיעור האחרון שהיית בו <i class="far fa-caret-square-left"></i></a>
          {% else %}
            {% if registration and user_course_completion_set.0 %}
            <a href={% url 'learn:completion_detail' user_course_completion_set.0.pk %}>קפוץ לשיעור הראשון <i class="far fa-caret-square-left"></i></a>
            {% else %}
            <a class="btn btn-info" href={% url 'learn:course_sign' course.id %}>
              הוסף את הקורס לרשימה שלי
            </a>
            {%  endif %}

          {% endif %}
        </div>
        <div class="col-2"></div>
      </div>
      {% endif %}

      <p>{{ course.description|safe }}</p>
    </div>

    <div class="row justify-content-center">
      <div class="col-11 rounded-lg bg-secondary p-3 px-5 ">
        {% if course.youtube %}
        <div class="embed-responsive embed-responsive-16by9">
          <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/{{ course.youtube }}?rel=0" allowfullscreen></iframe>
        </div>
        {% else %}
        <h3>No Youtube.... </h3>
        {% endif %}
      </div>
    </div>
  </div>

  <!--                        -->
  <!-- All courses section and info -->
  <!--                        -->

  <div class="col-3">


    <div class="border border-top border-info mb-3">
      <ul>
        {% if not user.is_authenticated %}
          <a class="btn btn-info mt-3" href="{% url 'login' %}?next=/learn/course/{{ course.id }}">התחבר </a>
          <br><br>
        {% endif %}
        {% if user.is_authenticated %}
          {% if registration %}
            <li><a href={% url 'learn:course_unsign' course.id %}><i class="far fa-trash-alt text-danger"></i> הסר את הקורס מהרשימה שלי</a></li>
          {% else %}

              <a class="btn btn-info mt-3" href={% url 'learn:course_sign' course.id %}>
                הוסף את הקורס לרשימה שלי
              </a>
              <br><br>
          {% endif %}
          <li><a href={% url 'learn:course_list' %}><i class="fas fa-list-ol"></i> חזרה לרשימת כל הקורסים</a></li>
        {% endif %}
      </ul>
    </div>

    {% if course.hebrew %}
        {% include "learn/course_status_heb.html" %}
    {% else %}
        {% include "learn/course_status_en.html" %}
    {% endif %}
  </div>
</div>


</div>
{% endblock %}
